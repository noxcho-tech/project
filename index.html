<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>Mint Sudoku Extreme</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Inter von Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --mint: #10a37f;
      --radius-lg: 14px;
      --radius-pill: 999px;
      --transition-fast: 0.18s ease-out;

      /* Light theme */
      --bg: #f3f4f6;
      --bg-elevated: #ffffff;
      --bg-subtle: #e5f5f0;
      --text: #111827;
      --text-soft: #6b7280;
      --border-subtle: rgba(15, 23, 42, 0.08);
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.08);
    }

    body.dark {
      /* Dark theme ähnlich ChatGPT */
      --bg: #202123;
      --bg-elevated: #2b2c2f;
      --bg-subtle: #1f2933;
      --text: #e5e7eb;
      --text-soft: #9ca3af;
      --border-subtle: rgba(148, 163, 184, 0.25);
      --shadow-soft: 0 18px 40px rgba(0, 0, 0, 0.7);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont,
        "SF Pro Text", sans-serif;
      background: radial-gradient(circle at top, rgba(16,163,127,0.18), transparent),
                  var(--bg);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: stretch;
      padding: 16px;
      transition:
        background-color var(--transition-fast),
        color var(--transition-fast);
    }

    .page {
      width: 100%;
      max-width: 1200px;
      background: rgba(255,255,255,0.0);
    }

    /* Top Bar wie sudoku.com, nur cleaner */
    .topbar {
      background: var(--bg-elevated);
      border-radius: 14px;
      padding: 10px 14px;
      box-shadow: var(--shadow-soft);
      border: 1px solid var(--border-subtle);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 12px;
    }

    .topbar-left {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }

    .logo {
      width: 32px;
      height: 32px;
      border-radius: 12px;
      background: radial-gradient(circle at 0 0, #6ee7b7, var(--mint));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: white;
      font-size: 16px;
      box-shadow: 0 10px 25px rgba(16, 163, 127, 0.45);
      flex-shrink: 0;
    }

    .logo-text-main {
      font-weight: 600;
      font-size: 15px;
    }

    .logo-text-sub {
      font-size: 11px;
      color: var(--text-soft);
    }

    .topbar-center {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: center;
      flex: 1;
    }

    .difficulty-pill {
      font-size: 11px;
      padding: 5px 9px;
      border-radius: var(--radius-pill);
      border: 1px solid transparent;
      background: transparent;
      color: var(--text-soft);
      cursor: default;
      user-select: none;
    }

    .difficulty-pill.active {
      background: rgba(16,163,127,0.1);
      color: var(--mint);
      border-color: rgba(16,163,127,0.7);
      font-weight: 600;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-shrink: 0;
    }

    /* Dark mode toggle */
    .theme-toggle {
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: radial-gradient(circle at 0 0, rgba(16, 163, 127, 0.18), rgba(24, 24, 27, 0));
      padding: 4px 7px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      font-size: 12px;
      color: var(--text-soft);
      position: relative;
      overflow: hidden;
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
      transition:
        border-color var(--transition-fast),
        background-color var(--transition-fast),
        color var(--transition-fast),
        transform 0.12s ease-out;
    }

    .theme-toggle:hover {
      transform: translateY(-1px);
      border-color: rgba(16, 163, 127, 0.7);
    }

    .theme-toggle .pill {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: var(--bg-elevated);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 20px rgba(15, 23, 42, 0.36);
      transition:
        background-color var(--transition-fast),
        transform var(--transition-fast);
    }

    .theme-toggle-icon {
      width: 13px;
      height: 13px;
    }

    body.dark .theme-toggle .pill {
      transform: translateX(8px);
      background: var(--mint);
    }

    body.dark .theme-toggle {
      color: #e5e7eb;
      border-color: rgba(148, 163, 184, 0.6);
    }

    /* Layout unter der Topbar: links Spiel, rechts Sidebar */
    .layout {
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(260px, 1fr);
      gap: 16px;
      margin-top: 10px;
    }

    @media (max-width: 900px) {
      .layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    /* Game Area */
    .game-card {
      background: var(--bg-elevated);
      border-radius: 16px;
      padding: 14px 16px 14px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .game-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      font-size: 12px;
      color: var(--text-soft);
      flex-wrap: wrap;
    }

    .toolbar-left {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .difficulty-label {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 9px;
      border-radius: var(--radius-pill);
      background: var(--bg-subtle);
      border: 1px solid rgba(148, 163, 184, 0.3);
      color: var(--mint);
      font-weight: 500;
      font-size: 11px;
    }

    .stat-chip {
      padding: 3px 8px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(148, 163, 184, 0.25);
      background: transparent;
      font-size: 11px;
      color: var(--text-soft);
    }

    .stat-chip strong {
      color: var(--text);
      font-variant-numeric: tabular-nums;
    }

    .toolbar-right {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .btn {
      border-radius: var(--radius-pill);
      padding: 6px 11px;
      font-size: 12px;
      border: 1px solid rgba(148, 163, 184, 0.45);
      background: var(--bg-subtle);
      color: var(--text);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition:
        background-color var(--transition-fast),
        border-color var(--transition-fast),
        transform 0.08s ease-out;
    }

    .btn-primary {
      background: linear-gradient(90deg, #6ee7b7, var(--mint));
      border-color: rgba(16, 163, 127, 0.85);
      color: #0f172a;
      font-weight: 600;
    }

    .btn:hover {
      transform: translateY(-1px);
      border-color: rgba(16, 163, 127, 0.85);
    }

    .board-wrapper {
      margin-top: 4px;
      padding: 10px;
      border-radius: 14px;
      background: radial-gradient(circle at top, rgba(148,163,184,0.15), transparent),
                  #f9fafb;
      border: 1px solid rgba(148, 163, 184, 0.35);
    }

    body.dark .board-wrapper {
      background: radial-gradient(circle at top, rgba(15,23,42,0.9), transparent),
                  #111827;
      border-color: rgba(55, 65, 81, 0.9);
    }

    .board {
      max-width: 480px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      border-radius: 10px;
      overflow: hidden;
      background: var(--bg-elevated);
      border: 2px solid rgba(55, 65, 81, 0.7);
    }

    .cell {
      width: 100%;
      padding-bottom: 100%; /* Quadrat */
      position: relative;
      border: 1px solid rgba(148, 163, 184, 0.35);
      background: rgba(243,244,246,0.9);
    }

    body.dark .cell {
      background: #111827;
      border-color: rgba(55, 65, 81, 0.8);
    }

    .cell[data-bottom-block="true"] {
      border-bottom-width: 2px;
    }
    .cell[data-right-block="true"] {
      border-right-width: 2px;
    }

    .cell-input {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: none;
      background: transparent;
      text-align: center;
      font-size: 26px;
      font-weight: 500;
      color: var(--text);
      outline: none;
      caret-color: var(--mint);
    }

    .cell-input:focus {
      background: rgba(16, 163, 127, 0.12);
    }

    .cell.fixed .cell-input {
      font-weight: 700;
      color: var(--mint);
      cursor: default;
    }

    .cell.invalid .cell-input {
      color: #ef4444;
    }

    .number-pad-wrapper {
      margin-top: 10px;
    }

    .number-pad {
      max-width: 480px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(10, minmax(0, 1fr));
      gap: 6px;
    }

    .num-key {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: var(--bg-elevated);
      padding: 8px 0;
      font-size: 14px;
      text-align: center;
      cursor: pointer;
      user-select: none;
      font-weight: 500;
      transition:
        background-color var(--transition-fast),
        transform 0.06s ease-out,
        border-color var(--transition-fast);
    }

    .num-key:hover {
      transform: translateY(-1px);
      border-color: rgba(16, 163, 127, 0.85);
    }

    .num-key.clear-key {
      font-size: 12px;
      color: var(--text-soft);
    }

    .game-message {
      margin-top: 8px;
      font-size: 12px;
      color: var(--text-soft);
      text-align: center;
      min-height: 16px;
    }

    .sidebar-card {
      background: var(--bg-elevated);
      border-radius: 16px;
      padding: 12px 13px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      font-size: 12px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .sidebar-title {
      font-size: 12px;
      font-weight: 600;
    }

    .leaderboard-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 11px;
    }

    .leaderboard-table th,
    .leaderboard-table td {
      padding: 4px 6px;
      text-align: left;
      border-bottom: 1px solid rgba(148, 163, 184, 0.25);
    }

    .leaderboard-table th {
      font-weight: 600;
      color: var(--text-soft);
    }

    .leaderboard-table tr:nth-child(1) td:first-child {
      font-weight: 700;
      color: var(--mint);
    }

    .hint-list {
      padding-left: 16px;
      color: var(--text-soft);
      font-size: 11px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    footer {
      font-size: 11px;
      color: var(--text-soft);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 12px;
      padding: 4px 2px;
      flex-wrap: wrap;
    }

    footer a {
      color: var(--mint);
      text-decoration: none;
      font-weight: 500;
      border-bottom: 1px solid transparent;
      padding-bottom: 1px;
    }

    footer a:hover {
      border-bottom-color: rgba(16, 163, 127, 0.5);
    }
  </style>
</head>
<body>
  <div class="page">
    <!-- TOPBAR -->
    <div class="topbar">
      <div class="topbar-left">
        <div class="logo">S</div>
        <div>
          <div class="logo-text-main">Mint Sudoku</div>
          <div class="logo-text-sub">minimalistisches 9×9 · Extreme</div>
        </div>
      </div>

      <div class="topbar-center">
        <span class="difficulty-pill">Leicht</span>
        <span class="difficulty-pill">Mittel</span>
        <span class="difficulty-pill">Schwer</span>
        <span class="difficulty-pill">Experte</span>
        <span class="difficulty-pill">Meister</span>
        <span class="difficulty-pill active">Extrem</span>
      </div>

      <div class="topbar-right">
        <button class="theme-toggle" id="theme-toggle" aria-label="Dark Mode umschalten">
          <div class="pill">
            <svg class="theme-toggle-icon" viewBox="0 0 24 24" aria-hidden="true">
              <path
                d="M12 4.5a7.5 7.5 0 1 0 7.04 9.9A6.5 6.5 0 0 1 12 4.5z"
                fill="currentColor"
              />
            </svg>
          </div>
          <span id="theme-label">Dark</span>
        </button>
      </div>
    </div>

    <!-- HAUPTLAYOUT -->
    <div class="layout">
      <!-- SPIEL -->
      <section class="game-card">
        <div class="game-toolbar">
          <div class="toolbar-left">
            <div class="difficulty-label">
              Extrem
            </div>
            <div class="stat-chip">
              Zeit: <strong><span id="timer">00:00</span></strong>
            </div>
            <div class="stat-chip">
              Fehler: <strong><span id="mistakes">0</span>/3</strong>
            </div>
          </div>

          <div class="toolbar-right">
            <button class="btn btn-primary" id="btn-new">Neues Spiel</button>
            <button class="btn" id="btn-check">Prüfen</button>
            <button class="btn" id="btn-solve">Aufgeben</button>
          </div>
        </div>

        <div class="board-wrapper">
          <div class="board" id="board"></div>
        </div>

        <div class="number-pad-wrapper">
          <div class="number-pad">
            <div class="num-key" data-num="1">1</div>
            <div class="num-key" data-num="2">2</div>
            <div class="num-key" data-num="3">3</div>
            <div class="num-key" data-num="4">4</div>
            <div class="num-key" data-num="5">5</div>
            <div class="num-key" data-num="6">6</div>
            <div class="num-key" data-num="7">7</div>
            <div class="num-key" data-num="8">8</div>
            <div class="num-key" data-num="9">9</div>
            <div class="num-key clear-key" data-clear="true">Löschen</div>
          </div>
        </div>

        <div class="game-message" id="message"></div>
      </section>

      <!-- SIDEBAR -->
      <section style="display:flex; flex-direction:column; gap:12px;">
        <article class="sidebar-card">
          <div class="sidebar-title">Bestenliste (lokal)</div>
          <table class="leaderboard-table">
            <thead>
              <tr>
                <th>#</th>
                <th>Name</th>
                <th>Zeit</th>
                <th>Datum</th>
              </tr>
            </thead>
            <tbody id="leaderboard">
              <tr>
                <td colspan="4">Noch keine Einträge – löse dein erstes Sudoku!</td>
              </tr>
            </tbody>
          </table>
        </article>

        <article class="sidebar-card">
          <div class="sidebar-title">So spielst du</div>
          <ul class="hint-list">
            <li>Klicke eine Zelle im 9×9-Grid an.</li>
            <li>Wähle unten eine Zahl 1–9.</li>
            <li>Jede Zeile, Spalte und jeder 3×3-Block enthält die Zahlen 1–9 genau einmal.</li>
            <li>„Prüfen“ markiert falsche Zellen rot und zählt einen Fehler.</li>
            <li>Bei 3 Fehlern ist das Spiel verloren.</li>
          </ul>
        </article>
      </section>
    </div>

    <footer>
      <span>Optik inspiriert von sudoku.com, aber bewusst minimalistisch im Mint-Stil.</span>
      <span>Dark Mode angelehnt an ChatGPT · Bestenliste nur lokal gespeichert.</span>
    </footer>
  </div>

  <script>
    // ---------- Dark Mode ----------
    (function () {
      const body = document.body;
      const toggle = document.getElementById("theme-toggle");
      const label = document.getElementById("theme-label");

      const prefersDark = window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      const stored = window.localStorage.getItem("mint-sudoku-theme");

      if (stored === "dark" || (!stored && prefersDark)) {
        body.classList.add("dark");
      }

      function updateLabel() {
        const isDark = body.classList.contains("dark");
        label.textContent = isDark ? "Light" : "Dark";
      }

      updateLabel();

      toggle.addEventListener("click", () => {
        const isDark = body.classList.toggle("dark");
        window.localStorage.setItem("mint-sudoku-theme", isDark ? "dark" : "light");
        updateLabel();
      });
    })();

    // ---------- Sudoku Logik ----------
    const SIZE = 9;
    const EMPTY = 0;
    const MAX_MISTAKES = 3;

    let solutionGrid = [];
    let fixedGrid = [];
    let timerInterval = null;
    let secondsElapsed = 0;
    let gameActive = false;
    let mistakes = 0;
    let activeInput = null;

    const boardEl = document.getElementById("board");
    const messageEl = document.getElementById("message");
    const timerEl = document.getElementById("timer");
    const mistakesEl = document.getElementById("mistakes");
    const leaderboardBody = document.getElementById("leaderboard");

    function shuffle(array) {
      const arr = array.slice();
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function generateFullGrid() {
      const base = 3;
      const side = base * base;

      const pattern = (r, c) => (base * (r % base) + Math.floor(r / base) + c) % side;
      const rows = shuffle([0,1,2]).flatMap(g => shuffle([0,1,2]).map(r => g * base + r));
      const cols = shuffle([0,1,2]).flatMap(g => shuffle([0,1,2]).map(c => g * base + c));
      const nums = shuffle([1,2,3,4,5,6,7,8,9]);

      const grid = Array.from({ length: side }, () => Array(side).fill(0));
      for (let r = 0; r < side; r++) {
        for (let c = 0; c < side; c++) {
          grid[r][c] = nums[pattern(rows[r], cols[c])];
        }
      }
      return grid;
    }

    function createPuzzle(fullGrid, empties = 60) {
      const grid = fullGrid.map(row => row.slice());
      const totalCells = SIZE * SIZE;
      const cellsToRemove = Math.min(empties, totalCells);

      const indices = shuffle(
        Array.from({ length: totalCells }, (_, i) => i)
      );

      for (let i = 0; i < cellsToRemove; i++) {
        const idx = indices[i];
        const r = Math.floor(idx / SIZE);
        const c = idx % SIZE;
        grid[r][c] = EMPTY;
      }

      return grid;
    }

    function clearBoard() {
      boardEl.innerHTML = "";
    }

    function renderBoard(puzzleGrid) {
      clearBoard();
      fixedGrid = puzzleGrid.map(row => row.slice());

      for (let r = 0; r < SIZE; r++) {
        for (let c = 0; c < SIZE; c++) {
          const value = puzzleGrid[r][c];

          const cell = document.createElement("div");
          cell.className = "cell";

          const isBottomBlock = (r + 1) % 3 === 0 && r !== SIZE - 1;
          const isRightBlock = (c + 1) % 3 === 0 && c !== SIZE - 1;
          if (isBottomBlock) cell.dataset.bottomBlock = "true";
          if (isRightBlock) cell.dataset.rightBlock = "true";

          const input = document.createElement("input");
          input.type = "text";
          input.inputMode = "numeric";
          input.maxLength = 1;
          input.className = "cell-input";
          input.dataset.row = r;
          input.dataset.col = c;

          if (value !== EMPTY) {
            input.value = value;
            cell.classList.add("fixed");
            input.readOnly = true;
          }

          input.addEventListener("focus", () => {
            activeInput = input;
            messageEl.textContent = "";
            cell.classList.remove("invalid");
          });

          input.addEventListener("input", (e) => {
            const v = e.target.value.replace(/[^1-9]/g, "");
            e.target.value = v;
            cell.classList.remove("invalid");
            messageEl.textContent = "";
          });

          cell.appendChild(input);
          boardEl.appendChild(cell);
        }
      }
    }

    function startTimer() {
      stopTimer();
      secondsElapsed = 0;
      updateTimerDisplay();
      timerInterval = setInterval(() => {
        secondsElapsed++;
        updateTimerDisplay();
      }, 1000);
    }

    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
    }

    function updateTimerDisplay() {
      const minutes = String(Math.floor(secondsElapsed / 60)).padStart(2, "0");
      const seconds = String(secondsElapsed % 60).padStart(2, "0");
      timerEl.textContent = `${minutes}:${seconds}`;
    }

    function updateMistakesDisplay() {
      mistakesEl.textContent = mistakes;
    }

    function readCurrentBoard() {
      const values = Array.from({ length: SIZE }, () => Array(SIZE).fill(EMPTY));
      const inputs = boardEl.querySelectorAll(".cell-input");
      inputs.forEach(input => {
        const r = parseInt(input.dataset.row, 10);
        const c = parseInt(input.dataset.col, 10);
        const v = input.value ? parseInt(input.value, 10) : EMPTY;
        if (!Number.isNaN(v)) {
          values[r][c] = v;
        }
      });
      return values;
    }

    function checkBoard(showErrors = true) {
      const current = readCurrentBoard();
      let hasError = false;
      let incomplete = false;

      const cells = boardEl.querySelectorAll(".cell");
      cells.forEach(cell => cell.classList.remove("invalid"));

      for (let r = 0; r < SIZE; r++) {
        for (let c = 0; c < SIZE; c++) {
          const val = current[r][c];
          if (val === EMPTY) {
            incomplete = true;
            continue;
          }
          if (val !== solutionGrid[r][c]) {
            hasError = true;
            if (showErrors) {
              const selector = `.cell-input[data-row="${r}"][data-col="${c}"]`;
              const input = boardEl.querySelector(selector);
              if (input) {
                input.parentElement.classList.add("invalid");
              }
            }
          }
        }
      }

      if (hasError) {
        mistakes = Math.min(mistakes + 1, MAX_MISTAKES);
        updateMistakesDisplay();
        if (mistakes >= MAX_MISTAKES) {
          gameActive = false;
          stopTimer();
          messageEl.textContent = "Du hast 3 Fehler gemacht – Spiel verloren. Auf „Aufgeben“ klicken, um die Lösung zu sehen.";
        } else {
          messageEl.textContent = "Es gibt noch Fehler im Grid.";
        }
        return false;
      }

      if (incomplete) {
        messageEl.textContent = "Bis jetzt korrekt, aber noch nicht vollständig.";
        return false;
      }

      // korrekt & vollständig
      return true;
    }

    function showSolution() {
      const inputs = boardEl.querySelectorAll(".cell-input");
      inputs.forEach(input => {
        const r = parseInt(input.dataset.row, 10);
        const c = parseInt(input.dataset.col, 10);
        input.value = solutionGrid[r][c];
      });
    }

    // ---------- Leaderboard ----------
    function loadLeaderboard() {
      try {
        const raw = window.localStorage.getItem("mint-sudoku-leaderboard");
        if (!raw) return [];
        const parsed = JSON.parse(raw);
        if (!Array.isArray(parsed)) return [];
        return parsed;
      } catch {
        return [];
      }
    }

    function saveLeaderboard(entries) {
      window.localStorage.setItem("mint-sudoku-leaderboard", JSON.stringify(entries));
    }

    function formatTime(seconds) {
      const minutes = String(Math.floor(seconds / 60)).padStart(2, "0");
      const secs = String(seconds % 60).padStart(2, "0");
      return `${minutes}:${secs}`;
    }

    function renderLeaderboard() {
      const entries = loadLeaderboard();
      leaderboardBody.innerHTML = "";

      if (entries.length === 0) {
        const tr = document.createElement("tr");
        const td = document.createElement("td");
        td.colSpan = 4;
        td.textContent = "Noch keine Einträge – löse dein erstes Sudoku!";
        tr.appendChild(td);
        leaderboardBody.appendChild(tr);
        return;
      }

      entries
        .sort((a, b) => a.time - b.time)
        .slice(0, 10)
        .forEach((entry, index) => {
          const tr = document.createElement("tr");
          const rankTd = document.createElement("td");
          rankTd.textContent = index + 1;

          const nameTd = document.createElement("td");
          nameTd.textContent = entry.name || "Gast";

          const timeTd = document.createElement("td");
          timeTd.textContent = formatTime(entry.time);

          const dateTd = document.createElement("td");
          dateTd.textContent = entry.date || "";

          tr.appendChild(rankTd);
          tr.appendChild(nameTd);
          tr.appendChild(timeTd);
          tr.appendChild(dateTd);
          leaderboardBody.appendChild(tr);
        });
    }

    function addToLeaderboard(seconds) {
      const name = prompt("Glückwunsch! Trage deinen Namen für die Bestenliste ein:", "Gast") || "Gast";
      const entries = loadLeaderboard();
      const now = new Date();
      const dateStr = now.toLocaleDateString();

      entries.push({
        name,
        time: seconds,
        date: dateStr
      });

      saveLeaderboard(entries);
      renderLeaderboard();
    }

    // ---------- Game Setup ----------
    function newGame() {
      gameActive = true;
      messageEl.textContent = "";
      mistakes = 0;
      updateMistakesDisplay();
      activeInput = null;

      solutionGrid = generateFullGrid();
      const puzzle = createPuzzle(solutionGrid, 60); // viele leere Felder = „extreme“
      renderBoard(puzzle);
      startTimer();
    }

    // Nummern-Pad
    document.querySelectorAll(".num-key").forEach(key => {
      key.addEventListener("click", () => {
        if (!gameActive) {
          messageEl.textContent = "Starte zuerst ein neues Spiel.";
          return;
        }
        if (!activeInput) {
          messageEl.textContent = "Wähle zuerst eine Zelle aus.";
          return;
        }
        if (activeInput.readOnly) {
          messageEl.textContent = "Diese Zelle ist vorgegeben und kann nicht geändert werden.";
          return;
        }

        const cell = activeInput.parentElement;
        cell.classList.remove("invalid");

        if (key.dataset.clear) {
          activeInput.value = "";
          return;
        }

        const num = key.dataset.num;
        activeInput.value = num;
        messageEl.textContent = "";
      });
    });

    // Buttons
    document.getElementById("btn-new").addEventListener("click", () => {
      newGame();
    });

    document.getElementById("btn-check").addEventListener("click", () => {
      if (!gameActive) {
        messageEl.textContent = "Kein aktives Spiel – starte ein neues Sudoku.";
        return;
      }

      const solved = checkBoard(true);
      if (solved) {
        gameActive = false;
        stopTimer();
        messageEl.textContent = "Perfekt! Du hast das Sudoku gelöst.";
        addToLeaderboard(secondsElapsed);
      }
    });

    document.getElementById("btn-solve").addEventListener("click", () => {
      if (!solutionGrid.length) return;
      const confirmGiveUp = confirm("Willst du wirklich aufgeben und die Lösung sehen?");
      if (!confirmGiveUp) return;

      gameActive = false;
      stopTimer();
      showSolution();
      messageEl.textContent = "Lösung eingeblendet. Versuche beim nächsten Mal, es selbst zu lösen!";
    });

    // Initial
    renderLeaderboard();
    newGame();
  </script>
</body>
</html>
